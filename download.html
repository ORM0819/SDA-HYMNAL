<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Downloading Files...</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        #progress-container {
            margin: 20px auto;
            width: 80%;
            max-width: 600px;
            border: 2px solid black; /* Black outline for the container */
            border-radius: 5px;
            background-color: #f0f0f0; /* Light background for the container */
            position: relative; /* For positioning the text inside */
            height: 30px; /* Height of the progress bar */
            display: flex; /* Use flexbox for centering content */
            align-items: center; /* Center content vertically */
            justify-content: center; /* Center content horizontally */
        }
        #progress-bar {
            height: 100%; /* Full height of the container */
            background-color: #4caf50;
            color: #fff;
            border-radius: 5px;
            position: absolute; /* Absolute positioning within the container */
            top: 0;
            left: 0;
            z-index: 1; /* Ensure it stays behind the text */
            width: 0; /* Initialize width */
        }
        #progress-text {
            position: absolute; /* Absolute positioning within the container */
            color: black;
            font-weight: bold;
            z-index: 2; /* Ensure text is above the progress bar */
        }
        iframe {
            width: 100%;
            height: 500px;
            border: none;
        }
    </style>
</head>
<body>
    <h1>Downloading Files...</h1>
    
    <div id="progress-container">
        <div id="progress-bar"></div>
        <div id="progress-text">0%</div>
    </div>

    <script>
        // Check if the item already exists before setting it
        if (!localStorage.getItem('download')) {
            localStorage.setItem('download', 'download');
        }
    </script>
    
    <iframe src="auto-cycle.html" id="cycle-frame"></iframe>

        <script>
            
        function updateProgressBar() {
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');

            // Retrieve current progress values from localStorage
            const currentIndex = parseInt(localStorage.getItem('currentIndex'), 10) || 0;
            const currentIndexLyrics = parseInt(localStorage.getItem('currentIndexLyrics'), 10) || 0;
            
            // Define offsets and total parts
            const englishMusicScoreOffset = 0;
            const spanishMusicScoreOffset = 695;
            const spanishLyricsOffset = 1309;
            const englishLyricsOffset = 1923;
            const totalParts = 2618;

            // Determine the total progress
            let totalProgress = 0;
            const dropdownValue = localStorage.getItem('dropdownValue');
            const languageValue = localStorage.getItem('languageValue');

            if (dropdownValue === 'music-score') {
                if (languageValue === 'english') {
                    totalProgress = currentIndex + englishMusicScoreOffset;
                } else if (languageValue === 'spanish') {
                    totalProgress = currentIndex + spanishMusicScoreOffset;
                }
            } else if (dropdownValue === 'lyrics') {
                if (languageValue === 'english') {
                    totalProgress = currentIndexLyrics + englishLyricsOffset;
                } else if (languageValue === 'spanish') {
                    totalProgress = currentIndexLyrics + spanishLyricsOffset;
                }
            }

            // Ensure totalProgress does not exceed the total number of parts
            totalProgress = Math.min(totalProgress, totalParts);

            // Update the progress bar
            const progressPercentage = (totalProgress / totalParts * 100).toFixed(2);
            progressBar.style.width = progressPercentage + '%';
            progressText.textContent = progressPercentage + '%';

            // Update the progress every 10ms
            setTimeout(updateProgressBar, 10);
        }

        document.addEventListener('DOMContentLoaded', updateProgressBar);
    </script>

</body>
</html>
